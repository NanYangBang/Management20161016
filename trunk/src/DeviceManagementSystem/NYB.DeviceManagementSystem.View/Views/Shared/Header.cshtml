@*background-image:url(@Url.Content("~/" + NYB.DeviceManagementSystem.Common.SystemInfo.CurrentSystemLogo))*@
@using NYB.DeviceManagementSystem.ViewModel

<script src="@Url.Content("~/Scripts/swfobject.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery-ui-1.8.24.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.min.js")" type="text/javascript"></script>
<link rel="Stylesheet" href="@Url.Content("~/Content/Common/OperateTable.css")" />
<link rel="stylesheet" href="~/Content/themes/jquery-ui.css">
<div class="header">
    <a href='@Url.Action(String.Empty, String.Empty)' title="回到主页">
        <div id="header-logo" class="header-logo">
            <h3 id="companyName" style="color:white;font-size:30px;">优稳运维管理系统</h3>
        </div>
    </a>
    <div class="header-message">
        <ul>
            <li><a target="_blank" href="http://www.ywcs.com.cn">官网</a></li>
            <li><a id="maintainCount" href="@Url.Action("Index", "Device")">需保养设备</a><a id="maintainCount" href="@Url.Action("Index", "Device")">0</a></li>
            <li><a id="resetPasswordRef" href="@Url.Action("ChangePassword", "Account")">修改密码</a></li>
            <li class="last-border"><a href="@Url.Action("LogOff", "Account", new { _ = DateTime.Now.Ticks })">退出</a></li>
        </ul>
        <p>
            @if (Request.IsAuthenticated)
            {
                <span>欢迎您, </span>@User.Identity.Name
            }
        </p>
    </div>

    <div hidden="hidden" id="passwordDialog">

    </div>
</div>
<script type="text/javascript">

    $(document).ready(function () {
        var isSuperAdmin = '@(Request.Cookies.Get("CurrentRole").Value == ((int)NYB.DeviceManagementSystem.Common.RoleType.超级管理员).ToString())';

        if (isSuperAdmin == 'False') {
            if (sessionStorage.SessionID == null || sessionStorage.SessionID !== '@Session.SessionID') {
                sessionStorage.SessionID = '@Session.SessionID'

                $.get('@Url.Action("GetCompanyInfoJson", "AboutUs", new { _ = DateTime.Now.Ticks })', {}, function (result) {
                    if (result.Code == '0') {
                        sessionStorage.CompanyInfo = JSON.stringify({
                            LogoFile: result.Data.LogoFile,
                            CompanyName: result.Data.CompanyName
                        });

                        var companyInfo = JSON.parse(sessionStorage.CompanyInfo);
                        if (companyInfo.LogoFile !== null & companyInfo.LogoFile !== '') {

                        }

                        if (companyInfo.CompanyName !== null & companyInfo.CompanyName !== '') {
                            $('#companyName').text(companyInfo.CompanyName);
                        }
                    } else {
                        alert(result.Msg);
                    }
                });
            } else {
                var companyInfo = JSON.parse(sessionStorage.CompanyInfo);
                if (companyInfo.LogoFile !== null & companyInfo.LogoFile !== '') {

                }

                if (companyInfo.CompanyName !== null & companyInfo.CompanyName !== '') {
                    $('#companyName').text(companyInfo.CompanyName);
                }
            }

            var maintainCountVisible = '@(Request.Cookies.Get("CurrentRole").Value == ((int)NYB.DeviceManagementSystem.Common.RoleType.超级管理员).ToString())';
        }

        @*$.get('@Url.Action("MaintainCount", "Device", new { _ = DateTime.Now.Ticks })', {}, function (data) {
            $("#maintainCount").text(data + 1);
        });*@


        $("#passwordDialog").dialog({
            autoOpen: false,
            resizable: false,
            modal: false,
            title: '修改密码',
            position: {
                my: "center",
                at: "center",
                of: window,
                collision: "fit",
            },
            close: function () {
                $('#passwordDialog').empty();
            },
            show: 'left',
            //dialogClass: 'promptPosition',
            hide: 'left',
            closeText: 'hide',
            width: 850,
            height: 400
        });

    })


    $("#resetPasswordRef").click(function (e) {
        e.preventDefault();
        @*$.post('@(Url.Action("ChangePassWord", "User", new { _ = DateTime.Now.Ticks }))', {}, function (data) {
            $('#passwordDialog').append(data);
        });*@

        $.ajax({
            type: 'get',
            url: '@(Url.Action("ChangePassWord", "User", new { _ = DateTime.Now.Ticks }))',
            async: true,
            data: {},
            success: function (data) {
                $('#passwordDialog').append(data);
            }
        });

        $("#passwordDialog").dialog("open");
    });

</script>
