@{
    ViewBag.Title = "AddRepairRecordPartialView";
}
@model NYB.DeviceManagementSystem.ViewModel.WebRepairRecord
@{
    ViewBag.Title = "";
    string isView = ViewBag.IsView;
    isView = string.IsNullOrWhiteSpace(isView) ? "" : isView.ToString();
    string returnUrl = ViewBag.ReturnUrl;
}

<script src="@Url.Content("~/Scripts/jquery.validate.min.js")" type="text/javascript"></script>

<script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.min.js")" type="text/javascript"></script>
<link rel="Stylesheet" href="@Url.Content("~/Content/Common/OperateTable.css")" />
<script src="@Url.Content("~/Scripts/Device/AddRepairRecord.js")"></script>
<script src="@Url.Content("~/Scripts/jquery-ui.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery-ui-timepicker-addon.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.ui.datepicker-zh-CN.js")" type="text/javascript"></script>

<div leftname="@(ViewBag.LeftName)" actionname="设备管理">
    <form method="post">
        @(Html.Hidden("returnUrl", returnUrl))
        <div class="common-details-panel">
            <h2>添加维修记录</h2>
            <input type="hidden" name="DeviceID" value="@(ViewBag.DeviceID)" />
            <input type="hidden" name="RepairRecordID" value="@(ViewBag.RepairRecordID)" />
            <fieldset>
                <table class="operateTable">
                    <tr>
                        <td>
                            <b>设备名称</b>
                        </td>
                        <td>
                            <input type="text" name="DeviceName" value="@(ViewBag.DeviceName)" />
                        </td>
                        <td>
                            <b><em>*</em>维修人</b>
                        </td>
                        <td>
                            @Html.TextBoxFor(model => model.Operator)
                            @Html.ValidationMessageFor(model => model.Operator)
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <b><em>*</em>维修日期</b>
                        </td>
                        <td name="time">
                            @Html.TextBoxFor(model => model.RepairDate)
                            @Html.ValidationMessageFor(model => model.RepairDate)
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <b>备注</b>
                        </td>
                        <td wt="580" ht="80" style="margin-top:5px" class="lengthTd">
                            @Html.TextAreaFor(model => model.Note)
                            @Html.ValidationMessageFor(model => model.Note)
                        </td>
                    </tr>
                </table>
                <div class="row" style="margin:0px;">
                    <div class="col-md-12">
                        <h3 style="font-size:12px">保养记录附件（支持jpg、gif、txt、png和pdf格式文件）</h3>
                        <input type="file" multiple id="ssi-upload" />
                    </div>
                </div>
            </fieldset>
        </div>
        <div class="common-details-operation-panel">
            <p class="UpdatePile-btn">
                <input type="submit" id="btnSave" value="保存" class="blue-button" />
                <a class="link-after-button" href="@ViewBag.ReturnUrl">返回</a>
            </p>
        </div>
    </form>
</div>
<link href="@Url.Content("~/Content/Plugin/jQuery-UI/jquery-ui-1.8.16.custom.css")" rel="stylesheet" type="text/css" />
<link href="@Url.Content("~/Content/Plugin/jQuery-UI-Timepicker/jquery-ui-timepicker.css")" rel="stylesheet" type="text/css" />
<script type="text/javascript">
    window.Resource = {
        UrlAdd: '@Url.Action("AddRepairRecord", "Device", new { _ = DateTime.Now.Ticks })',
        UrlEdit: '@(Url.Action("EditRepairRecord", "Device", new { _ = DateTime.Now.Ticks }))',
        ReturnUrl: '@returnUrl',
        Action: '@(ViewBag.OperateAction)',
        UrlImage: '@Url.Content("~/Content/Plugin/jQuery-UI-Timepicker/images/calendar.png")',
        IsView: '@(isView)',
        UrlAddFile: '@(Url.Action("AddRepairRecordFile", "Device", new { _ = DateTime.Now.Ticks }))',
        UrlEditFile: '@(Url.Action("AddRepairRecordFile", "Device", new { _ = DateTime.Now.Ticks }))'
    }

    $(document).ready(function () {
        SaveEvent();
        BindDatePick();
        GetViewStatus();
        $('[name="DeviceName"]').attr('readonly', 'readonly');
        AddTxtAre();
        uploadProof();
    })

    function BindDatePick() {
        var path = Resource.UrlImage;
        $('td[name="time"] input').datepicker({
            showButtonPanel: true,
            yearRange: 'c-10:c+2',
            showOn: "button", buttonImageOnly: true,
            numberOfMonths: 1,
            changeMonth: true,
            changeYear: true,
            buttonImage: path
        }).datepicker("option", "dateFormat", 'yy-mm-dd');;
        BindDatePickerTriggerEvent();
        $('td[name="time"] input').attr('readonly', 'readonly');

        if (Resource.Action == 'Update') {
            $('#RepairDate').val('@Model.RepairDate.ToString("yyyy-MM-dd")');
        }

    }

</script>